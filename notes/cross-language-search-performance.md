# 言語横断検索性能の比較（BGE-M3 vs Gemini）

## 概要
日本語クエリで英語ファイル名を検索する際の、BGE-M3とGeminiの性能差について検証した結果をまとめる。

## 検証内容

### テストケース
- **対象ファイル**: `JETLS/Incremental analysis system.md`
- **日本語クエリ**: 「JETLSのincremental analysis systemの実装状況を教えて」
- **英語クエリ**: 「Incremental analysis system」

### 検証結果

#### 1. 日本語クエリでの検索結果
| モデル | ヒット順位 | 関連度スコア | 備考 |
|--------|-----------|------------|------|
| BGE-M3 | ランク外 | - | トップ10に入らず |
| Gemini | 1位 | 0.792 | 正確にヒット |

#### 2. 英語クエリでの検索結果
| モデル | ヒット順位 | 関連度スコア | 備考 |
|--------|-----------|------------|------|
| BGE-M3 | 5位 | 0.540 | 低い関連度 |
| Gemini | 1位 | 0.710 | 高い関連度 |

## 原因分析

### 1. メタデータの埋め込み
両モデルとも、インデックス作成時に以下の形式でメタデータを埋め込んでいる：
```
Note title: JETLS/Incremental analysis system.md
Section title:
Last modified:
[実際のコンテンツ]
```

### 2. モデルの特性
- **BGE-M3**
  - 多言語対応モデルだが、日本語→英語の言語横断マッチングが弱い
  - 特に日本語クエリでの英語ファイル名検索で性能が劣る
  - チャンクサイズが大きい（3000トークン）ため、メタデータの影響が相対的に小さい

- **Gemini**
  - 言語横断のセマンティック検索が強力
  - 日本語クエリでも英語ファイル名を正確にマッチング
  - チャンクサイズが小さい（1500トークン）ため、メタデータの影響が大きい

### 3. 技術的要因
1. **埋め込み空間の違い**: Geminiは言語に依存しない意味表現をより効果的に学習
2. **トレーニングデータ**: Geminiは多言語・多文化のデータセットでトレーニングされている可能性
3. **アーキテクチャ**: BGE-M3は各言語で独立した表現を持つ可能性

## 推奨事項

### 使い分けの指針
- **日本語・英語混在環境**: Geminiを推奨
- **単一言語環境**: BGE-M3でも十分な性能
- **プライバシー重視**: BGE-M3（完全ローカル）

### 改善案
1. **BGE-M3の改善方法**
   - クエリ拡張：日本語クエリに英語キーワードを自動追加
   - インデックス時のメタデータ強化
   - チャンクサイズの調整（より小さく）

2. **ハイブリッドアプローチ**
   - 言語横断検索にはGeminiを使用
   - 単一言語検索にはBGE-M3を使用
   - 両方の結果を統合してランキング

## 結論
日本語と英語が混在する環境での検索には、現時点ではGeminiが優れた性能を示す。ただし、BGE-M3も適切な前処理やクエリ拡張により改善の余地がある。
